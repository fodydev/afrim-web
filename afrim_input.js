/*! For license information please see afrim_input.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,(()=>(()=>{var t,e,n,r,o={652:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.r(e),n.d(e,{Preprocessor:()=>i.i5,Translator:()=>i.rk,__wbg_String_b9412f8799faab3e:()=>i.Zu,__wbg_buffer_12d079cc21e14bdb:()=>i.Fm,__wbg_call_27c0f87801dedf93:()=>i.cq,__wbg_call_b3ca7c6051f9bec1:()=>i._m,__wbg_crypto_d05b68a3572bb8ca:()=>i.$D,__wbg_done_298b57d23c0fc80c:()=>i.uL,__wbg_entries_95cc2c823b285a09:()=>i.OZ,__wbg_getRandomValues_7e42b4fb8779dc6d:()=>i.Uv,__wbg_get_bd8e338fbd5f5cc8:()=>i.g_,__wbg_get_e3c254076557e348:()=>i.XB,__wbg_globalThis_d1e6af4856ba331b:()=>i.Kc,__wbg_global_207b558942527489:()=>i.vA,__wbg_instanceof_ArrayBuffer_836825be07d4c9d2:()=>i.B7,__wbg_instanceof_Uint8Array_2b3bbecd033d19f6:()=>i.QD,__wbg_isArray_2ab64d95e09ea0ae:()=>i.f3,__wbg_iterator_2cee6dadfd956dfa:()=>i.GR,__wbg_length_c20a40f15020d68a:()=>i.qY,__wbg_length_cd7af8117672b8b8:()=>i.O$,__wbg_msCrypto_10fc94afee92bd76:()=>i.Si,__wbg_new_16b304a2cfa7ff4a:()=>i.M2,__wbg_new_63b92bc8671ed464:()=>i.$Z,__wbg_new_72fb9a18b5ae2624:()=>i.ot,__wbg_new_d9bc3a0147634640:()=>i.ae,__wbg_newnoargs_e258087cd0daa0ea:()=>i.Pf,__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb:()=>i.Lo,__wbg_newwithlength_e9b4878cebadb3d3:()=>i.v6,__wbg_next_196c84450b364254:()=>i.iS,__wbg_next_40fc327bfc8770e6:()=>i.Xo,__wbg_node_43b1089f407e4ec2:()=>i.MF,__wbg_now_4e659b3d15f470d9:()=>i.xZ,__wbg_process_b02b3570280d0366:()=>i.Mx,__wbg_randomFillSync_b70ccbdf4926a99d:()=>i.zQ,__wbg_require_9a7e0f667ead4995:()=>i.O6,__wbg_self_ce0dbfc45cf2f5be:()=>i.cX,__wbg_set_8417257aaedc936b:()=>i.jg,__wbg_set_a47bac70306a19a7:()=>i.Wv,__wbg_set_d4638f722068f043:()=>i.QU,__wbg_set_f975102236d3c502:()=>i.DK,__wbg_set_wasm:()=>i.lI,__wbg_subarray_a1f73cd4b5b42fe1:()=>i.if,__wbg_value_d93c65011f51a456:()=>i.qT,__wbg_versions_c1cb42213cedf0f5:()=>i.Ke,__wbg_window_c6fb939a7f436783:()=>i.kh,__wbindgen_as_number:()=>i.qm,__wbindgen_bigint_from_i64:()=>i.ce,__wbindgen_boolean_get:()=>i.Nh,__wbindgen_debug_string:()=>i.rl,__wbindgen_error_new:()=>i.Rj,__wbindgen_is_function:()=>i.PR,__wbindgen_is_object:()=>i.qv,__wbindgen_is_string:()=>i.Gu,__wbindgen_is_undefined:()=>i.vU,__wbindgen_jsval_loose_eq:()=>i.U8,__wbindgen_memory:()=>i.Py,__wbindgen_number_get:()=>i.sW,__wbindgen_number_new:()=>i.QR,__wbindgen_object_clone_ref:()=>i.BZ,__wbindgen_object_drop_ref:()=>i.bk,__wbindgen_string_get:()=>i.qN,__wbindgen_string_new:()=>i.yc,__wbindgen_throw:()=>i.Qn,convertTomlToJson:()=>i.Xc});var o=n(524),i=n(320),s=t([o]);o=(s.then?(await s)():s)[0],(0,i.lI)(o),r()}catch(t){r(t)}}))},320:(t,e,n)=>{"use strict";let r;function o(t){r=t}n.d(e,{$D:()=>L,$Z:()=>St,B7:()=>pt,BZ:()=>F,DK:()=>Y,Fm:()=>Tt,GR:()=>dt,Gu:()=>B,Kc:()=>nt,Ke:()=>O,Lo:()=>Pt,M2:()=>at,MF:()=>$,Mx:()=>D,Nh:()=>X,O$:()=>st,O6:()=>M,OZ:()=>xt,PR:()=>V,Pf:()=>it,Py:()=>Ft,QD:()=>Rt,QR:()=>K,QU:()=>ht,Qn:()=>jt,Rj:()=>C,Si:()=>N,U8:()=>H,Uv:()=>Q,Wv:()=>At,XB:()=>Et,Xc:()=>E,Xo:()=>ct,Zu:()=>J,_m:()=>wt,ae:()=>_t,bk:()=>q,cX:()=>tt,ce:()=>G,cq:()=>gt,f3:()=>bt,g_:()=>ft,i5:()=>S,iS:()=>yt,if:()=>Ct,jg:()=>mt,kh:()=>et,lI:()=>o,ot:()=>ut,qN:()=>k,qT:()=>lt,qY:()=>qt,qm:()=>j,qv:()=>U,rk:()=>I,rl:()=>kt,sW:()=>Z,uL:()=>vt,v6:()=>It,vA:()=>rt,vU:()=>ot,xZ:()=>z,yc:()=>A,zQ:()=>W}),t=n.hmd(t);let i=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});i.decode();let s=null;function a(){return null!==s&&0!==s.byteLength||(s=new Uint8Array(r.memory.buffer)),s}function _(t,e){return t>>>=0,i.decode(a().subarray(t,t+e))}const c=new Array(128).fill(void 0);c.push(void 0,null,!0,!1);let l=c.length;function d(t){l===c.length&&c.push(c.length+1);const e=l;return l=c[e],c[e]=t,e}function u(t){return c[t]}function f(t){const e=u(t);return function(t){t<132||(c[t]=l,l=t)}(t),e}let h=0,b=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const p="function"==typeof b.encodeInto?function(t,e){return b.encodeInto(t,e)}:function(t,e){const n=b.encode(t);return e.set(n),{read:t.length,written:n.length}};function g(t,e,n){if(void 0===n){const n=b.encode(t),r=e(n.length,1)>>>0;return a().subarray(r,r+n.length).set(n),h=n.length,r}let r=t.length,o=e(r,1)>>>0;const i=a();let s=0;for(;s<r;s++){const e=t.charCodeAt(s);if(e>127)break;i[o+s]=e}if(s!==r){0!==s&&(t=t.slice(s)),o=n(o,r,r=s+3*t.length,1)>>>0;const e=a().subarray(o+s,o+r);s+=p(t,e).written,o=n(o,r,s,1)>>>0}return h=s,o}function w(t){return null==t}let m=null;function y(){return null!==m&&0!==m.byteLength||(m=new Int32Array(r.memory.buffer)),m}let v=null;function x(t){const e=typeof t;if("number"==e||"boolean"==e||null==t)return`${t}`;if("string"==e)return`"${t}"`;if("symbol"==e){const e=t.description;return null==e?"Symbol":`Symbol(${e})`}if("function"==e){const e=t.name;return"string"==typeof e&&e.length>0?`Function(${e})`:"Function"}if(Array.isArray(t)){const e=t.length;let n="[";e>0&&(n+=x(t[0]));for(let r=1;r<e;r++)n+=", "+x(t[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(!(n.length>1))return toString.call(t);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(t)+")"}catch(t){return"Object"}return t instanceof Error?`${t.name}: ${t.message}\n${t.stack}`:r}function E(t){try{const o=r.__wbindgen_add_to_stack_pointer(-16),i=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),s=h;r.convertTomlToJson(o,i,s);var e=y()[o/4+0],n=y()[o/4+1];if(y()[o/4+2])throw f(n);return f(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}function T(t,e){try{return t.apply(this,e)}catch(t){r.__wbindgen_exn_store(d(t))}}const P="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((t=>r.__wbg_preprocessor_free(t>>>0)));class S{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,P.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_preprocessor_free(t)}constructor(t,e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.preprocessor_new(i,d(t),e);var n=y()[i/4+0],o=y()[i/4+1];if(y()[i/4+2])throw f(o);return this.__wbg_ptr=n>>>0,this}finally{r.__wbindgen_add_to_stack_pointer(16)}}process(t,e){try{const i=r.__wbindgen_add_to_stack_pointer(-16),s=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),a=h,_=g(e,r.__wbindgen_malloc,r.__wbindgen_realloc),c=h;r.preprocessor_process(i,this.__wbg_ptr,s,a,_,c);var n=y()[i/4+0],o=y()[i/4+1];if(y()[i/4+2])throw f(o);return 0!==n}finally{r.__wbindgen_add_to_stack_pointer(16)}}commit(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),n=h;r.preprocessor_commit(this.__wbg_ptr,e,n)}popQueue(){return f(r.preprocessor_popQueue(this.__wbg_ptr))}getInput(){let t,e;try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.preprocessor_getInput(i,this.__wbg_ptr);var n=y()[i/4+0],o=y()[i/4+1];return t=n,e=o,_(n,o)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e,1)}}clearQueue(){r.preprocessor_clearQueue(this.__wbg_ptr)}}const R="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((t=>r.__wbg_translator_free(t>>>0)));class I{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_translator_free(t)}constructor(t,e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.translator_new(i,d(t),e);var n=y()[i/4+0],o=y()[i/4+1];if(y()[i/4+2])throw f(o);return this.__wbg_ptr=n>>>0,this}finally{r.__wbindgen_add_to_stack_pointer(16)}}register(t,e){try{const o=r.__wbindgen_add_to_stack_pointer(-16),i=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),s=h,a=g(e,r.__wbindgen_malloc,r.__wbindgen_realloc),_=h;r.translator_register(o,this.__wbg_ptr,i,s,a,_);var n=y()[o/4+0];if(y()[o/4+1])throw f(n)}finally{r.__wbindgen_add_to_stack_pointer(16)}}unregister(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),n=h;r.translator_unregister(this.__wbg_ptr,e,n)}translate(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),n=h;return f(r.translator_translate(this.__wbg_ptr,e,n))}}function C(t,e){return d(new Error(_(t,e)))}function q(t){f(t)}function A(t,e){return d(_(t,e))}function k(t,e){const n=u(e),o="string"==typeof n?n:void 0;var i=w(o)?0:g(o,r.__wbindgen_malloc,r.__wbindgen_realloc),s=h;y()[t/4+1]=s,y()[t/4+0]=i}function j(t){return+u(t)}function F(t){return d(u(t))}function U(t){const e=u(t);return"object"==typeof e&&null!==e}function L(t){return d(u(t).crypto)}function D(t){return d(u(t).process)}function O(t){return d(u(t).versions)}function $(t){return d(u(t).node)}function B(t){return"string"==typeof u(t)}function M(){return T((function(){return d(t.require)}),arguments)}function N(t){return d(u(t).msCrypto)}function W(){return T((function(t,e){u(t).randomFillSync(f(e))}),arguments)}function Q(){return T((function(t,e){u(t).getRandomValues(u(e))}),arguments)}function z(t){return u(t).now()}function H(t,e){return u(t)==u(e)}function X(t){const e=u(t);return"boolean"==typeof e?e?1:0:2}function Z(t,e){const n=u(e),o="number"==typeof n?n:void 0;(null!==v&&0!==v.byteLength||(v=new Float64Array(r.memory.buffer)),v)[t/8+1]=w(o)?0:o,y()[t/4+0]=!w(o)}function J(t,e){const n=g(String(u(e)),r.__wbindgen_malloc,r.__wbindgen_realloc),o=h;y()[t/4+1]=o,y()[t/4+0]=n}function K(t){return d(t)}function G(t){return d(t)}function Y(t,e,n){u(t)[f(e)]=f(n)}function V(t){return"function"==typeof u(t)}function tt(){return T((function(){return d(self.self)}),arguments)}function et(){return T((function(){return d(window.window)}),arguments)}function nt(){return T((function(){return d(globalThis.globalThis)}),arguments)}function rt(){return T((function(){return d(n.g.global)}),arguments)}function ot(t){return void 0===u(t)}function it(t,e){return d(new Function(_(t,e)))}function st(t){return u(t).length}function at(){return d(new Array)}function _t(){return d(new Map)}function ct(t){return d(u(t).next)}function lt(t){return d(u(t).value)}function dt(){return d(Symbol.iterator)}function ut(){return d(new Object)}function ft(t,e){return d(u(t)[e>>>0])}function ht(t,e,n){u(t)[e>>>0]=f(n)}function bt(t){return Array.isArray(u(t))}function pt(t){let e;try{e=u(t)instanceof ArrayBuffer}catch(t){e=!1}return e}function gt(){return T((function(t,e){return d(u(t).call(u(e)))}),arguments)}function wt(){return T((function(t,e,n){return d(u(t).call(u(e),u(n)))}),arguments)}function mt(t,e,n){return d(u(t).set(u(e),u(n)))}function yt(){return T((function(t){return d(u(t).next())}),arguments)}function vt(t){return u(t).done}function xt(t){return d(Object.entries(u(t)))}function Et(){return T((function(t,e){return d(Reflect.get(u(t),u(e)))}),arguments)}function Tt(t){return d(u(t).buffer)}function Pt(t,e,n){return d(new Uint8Array(u(t),e>>>0,n>>>0))}function St(t){return d(new Uint8Array(u(t)))}function Rt(t){let e;try{e=u(t)instanceof Uint8Array}catch(t){e=!1}return e}function It(t){return d(new Uint8Array(t>>>0))}function Ct(t,e,n){return d(u(t).subarray(e>>>0,n>>>0))}function qt(t){return u(t).length}function At(t,e,n){u(t).set(u(e),n>>>0)}function kt(t,e){const n=g(x(u(e)),r.__wbindgen_malloc,r.__wbindgen_realloc),o=h;y()[t/4+1]=o,y()[t/4+0]=n}function jt(t,e){throw new Error(_(t,e))}function Ft(){return d(r.memory)}},238:t=>{!function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,r=n&&null!=window.mozInnerScreenX;function o(t,o,i){if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var s=i&&i.debug||!1;if(s){var a=document.querySelector("#input-textarea-caret-position-mirror-div");a&&a.parentNode.removeChild(a)}var _=document.createElement("div");_.id="input-textarea-caret-position-mirror-div",document.body.appendChild(_);var c=_.style,l=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,d="INPUT"===t.nodeName;c.whiteSpace="pre-wrap",d||(c.wordWrap="break-word"),c.position="absolute",s||(c.visibility="hidden"),e.forEach((function(t){d&&"lineHeight"===t?c.lineHeight=l.height:c[t]=l[t]})),r?t.scrollHeight>parseInt(l.height)&&(c.overflowY="scroll"):c.overflow="hidden",_.textContent=t.value.substring(0,o),d&&(_.textContent=_.textContent.replace(/\s/g," "));var u=document.createElement("span");u.textContent=t.value.substring(o)||".",_.appendChild(u);var f={top:u.offsetTop+parseInt(l.borderTopWidth),left:u.offsetLeft+parseInt(l.borderLeftWidth),height:parseInt(l.lineHeight)};return s?u.style.backgroundColor="#aaa":document.body.removeChild(_),f}void 0!==t.exports?t.exports=o:n&&(window.getCaretCoordinates=o)}()},401:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.AfrimInput=void 0;const o=r(n(783));Object.defineProperty(e,"AfrimInput",{enumerable:!0,get:function(){return o.default}})},461:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AfrimConfig=void 0;const r=n(622);e.AfrimConfig=class{constructor(){this.data={},this.translation={},this.translators={}}async loadFromUrl(t){const e=await(0,r.httpGet)(t),n=await(0,r.tomlToJson)(e);let o=!1;if(n.has("core")&&(o=n.get("core").get("auto_capitalize")||!1),n.has("translation"))for(const e of n.get("translation")){const n=e[0],r=e[1];if("string"==typeof r)this.translation[n]=[r];else if(r.has("path"))await this.loadFromUrl(new URL(r.get("path"),t).href);else{if(!r.has("alias"))throw new Error(`load config error: ${r} unexpected`);{let t=null;t=r.has("values")?r.get("values"):[r.get("value")];for(const e of r.get("alias"))this.translation[e]=t;this.translation[n]=t}}}if(n.has("data"))for(const e of n.get("data")){const n=e[0],r=e[1];if("string"==typeof r)this.data[n]=r;else if(r.has("path"))await this.loadFromUrl(new URL(r.get("path"),t).href);else{if(!r.has("alias"))throw new Error(`load config error: ${r} unexpected`);{const t=r.get("value");for(const e of r.get("alias"))this.data[e]=t,o&&(this.data[t[0].toUpperCase()+t.slice(1)]=t.toUpperCase());this.data[n]=t,o&&(this.data[n[0].toUpperCase()+n.slice(1)]=t.toUpperCase())}}}if(n.has("translators"))for(const e of n.get("translators")){const n=e[0],o=e[1],i=await(0,r.httpGet)(new URL(o,t).href);this.translators[n]=i}}}},783:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(461);e.default=class{constructor(t){var e;if(this.animation=0,t={textFieldElementID:"textfield",downloadStatusElementID:"download-status",tooltipElementID:"tooltip",tooltipInputElementID:"tooltip-input",tooltipPredicatesElementID:"tooltip-predicates",tooltipPredicateClass:"dropdown-item",tooltipAdjustLeft:0,tooltipAdjustTop:0,configUrl:"https://raw.githubusercontent.com/fodydev/afrim-data/4b177197bb37c9742cd90627b1ad543c32ec791b/gez/gez.toml",...t},!(e=document.getElementById(t.textFieldElementID)))throw new Error(`element with id ${t.textFieldElementID} not found`);if(this.textFieldElement=e,!(e=document.getElementById(t.downloadStatusElementID)))throw new Error(`element with id ${t.downloadStatusElementID}`);if(this.downloadStatusElement=e,!(e=document.getElementById(t.tooltipElementID)))throw new Error(`element with id ${t.tooltipElementID}`);if(this.tooltipElement=e,!(e=document.getElementById(t.tooltipInputElementID)))throw new Error(`element with id ${t.tooltipInputElementID}`);if(this.tooltipInputElement=e,!(e=document.getElementById(t.tooltipPredicatesElementID)))throw new Error(`element with id ${t.tooltipPredicatesElementID}`);if(this.tooltipPredicatesElement=e,this.data={predicates:Array(),predicateId:0,pageSize:5,isIdle:!1,cursorPos:0,options:t},this.textFieldElement.dataset.lock)throw new Error("An afrim instance is already linked to this element.");this.textFieldElement.dataset.lock="true",this.textFieldElement.disabled=!0,this.downloadStatusElement.hidden=!1,this.loadConfigFromUrl(t.configUrl).then((async t=>{await this.initAfrim(t),this.listenKeyboard(),this.listenMouse(),this.listenTextFieldState(),this.processCommand(),this.textFieldElement.disabled=!1,this.downloadStatusElement.hidden=!0}),(t=>{console.error(`Error downloading configuration file: ${t}`)}))}clearPredicate(){this.tooltipPredicatesElement.innerHTML="",this.data.predicateId=0,this.data.predicates=Array()}loadPredicates(t){this.clearPredicate();var e=0;for(const n of t)for(const t of n.texts)this.data.predicates.push({id:++e,code:n.code,remainingCode:n.remaining_code,texts:[t],canCommit:n.can_commit})}updatePredicate(){this.tooltipPredicatesElement.innerHTML="";const t=this.data.predicates.slice(this.data.predicateId,this.data.predicates.length).concat(this.data.predicates.slice(0,this.data.predicateId));let e=0;for(const n of t){const t=0==e?"✏️":"";if(e++>this.data.pageSize)break;const r=document.createElement("a");r.classList.add(this.data.options.tooltipPredicateClass),r.innerText=`${t} ${n.id}. ${n.texts[0]} ~${n.remainingCode}`;for(let t of["pointerdown","click"])r.addEventListener(t,(()=>{this.preprocessor?.commit(n.texts[0]),this.preprocessor?.process("","keydown"),this.clearPredicate()}),!1);this.tooltipPredicatesElement.append(r)}}restoreCursorPosition(){this.textFieldElement.focus(),this.textFieldElement.setSelectionRange(this.data.cursorPos,this.data.cursorPos)}processCommand(){const t=this.preprocessor?.popQueue(),e=this.textFieldElement.value;this.data.cursorPos=this.data.cursorPos<0?0:this.data.cursorPos,t&&("Delete"==t?(this.textFieldElement.value=e.substring(0,this.data.cursorPos-1)+e.substring(this.data.cursorPos,e.length),this.data.cursorPos--,this.restoreCursorPosition()):"Pause"==t?this.data.isIdle=!0:"Resume"==t?this.data.isIdle=!1:"NOP"==t||t.CommitText&&(this.textFieldElement.value=e.substring(0,this.data.cursorPos)+t.CommitText+e.substring(this.data.cursorPos,e.length),this.data.cursorPos+=t.CommitText.length,this.restoreCursorPosition())),this.animation=requestAnimationFrame((()=>this.processCommand()))}async loadConfigFromUrl(t){let e=new r.AfrimConfig;return await e.loadFromUrl(t),e}async initAfrim(t){const e=await n(652);this.preprocessor=new e.Preprocessor(t.data,64),this.translator=new e.Translator(t.translation,!1);for(let e of Object.entries(t.translators))this.translator?.register(e[0],e[1])}listenKeyboard(){this.textFieldElement.addEventListener("keyup",(t=>{if(this.data.cursorPos=this.textFieldElement.selectionEnd??0,t.ctrlKey){if("ShiftLeft"==t.code)this.data.predicateId=this.data.predicateId<1?this.data.predicates.length-1:this.data.predicateId-1,this.updatePredicate();else if("ShiftRight"==t.code)this.data.predicateId=this.data.predicateId>=this.data.predicates.length-1?0:this.data.predicateId+1,this.updatePredicate();else if("Space"==t.code){var e=this.data.predicates[this.data.predicateId];e&&this.preprocessor?.commit(e.texts[0]),this.clearPredicate()}else"ControlLeft"!=t.code&&"ControlRight"!=t.code||(this.data.isIdle=!this.data.isIdle);return}if("GroupPrevious"==t.key||"GroupNext"==t.key)return;if(this.data.isIdle)return;const n=this.preprocessor?.process(t.key,"keydown"),r=this.preprocessor?.getInput()||"";if(!n)return;this.tooltipInputElement.innerText="📝 "+r;const o=this.translator?.translate(r);this.loadPredicates(o),this.updatePredicate()}),!1)}listenMouse(){this.textFieldElement.addEventListener("keyup",(t=>{const e=n(238)(this.textFieldElement,this.textFieldElement.selectionEnd);this.tooltipElement.style.top=this.data.options.tooltipAdjustTop+this.textFieldElement.offsetTop-this.textFieldElement.scrollTop+e.top+"px",this.tooltipElement.style.left=this.data.options.tooltipAdjustLeft+this.textFieldElement.offsetLeft-this.textFieldElement.scrollLeft+e.left+"px"}),!1)}listenTextFieldState(){for(let t of["click","touchstart"])this.textFieldElement.addEventListener(t,(()=>{this.tooltipElement.classList.add("is-active"),this.preprocessor?.process("","keydown"),this.clearPredicate()}),!1);this.textFieldElement.addEventListener("blur",(t=>{this.tooltipElement.classList.remove("is-active")}))}kill(){cancelAnimationFrame(this.animation),this.textFieldElement.replaceWith(this.textFieldElement.cloneNode(!0)),this.translator?.free(),this.preprocessor?.free(),delete this.textFieldElement.dataset.lock}}},622:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.tomlToJson=async function(t){return(await n(652)).convertTomlToJson(t)},e.httpGet=async function(t){const e=await(0,o.default)(t);if(!e.ok)throw new Error(`Fetch error: ${e.statusText}`);return await e.text()};const o=r(n(482))},482:(t,e,n)=>{"use strict";n.r(e),n.d(e,{HTTPError:()=>r,TimeoutError:()=>o,default:()=>S});class r extends Error{response;request;options;constructor(t,e,n){const r=`${t.status||0===t.status?t.status:""} ${t.statusText||""}`.trim();super(`Request failed with ${r?`status code ${r}`:"an unknown error"}: ${e.method} ${e.url}`),this.name="HTTPError",this.response=t,this.request=e,this.options=n}}class o extends Error{request;constructor(t){super(`Request timed out: ${t.method} ${t.url}`),this.name="TimeoutError",this.request=t}}const i=t=>null!==t&&"object"==typeof t,s=(...t)=>{for(const e of t)if((!i(e)||Array.isArray(e))&&void 0!==e)throw new TypeError("The `options` argument must be an object");return l({},...t)},a=(t={},e={})=>{const n=new globalThis.Headers(t),r=e instanceof globalThis.Headers,o=new globalThis.Headers(e);for(const[t,e]of o.entries())r&&"undefined"===e||void 0===e?n.delete(t):n.set(t,e);return n};function _(t,e,n){return Object.hasOwn(e,n)&&void 0===e[n]?[]:l(t[n]??[],e[n]??[])}const c=(t={},e={})=>({beforeRequest:_(t,e,"beforeRequest"),beforeRetry:_(t,e,"beforeRetry"),afterResponse:_(t,e,"afterResponse"),beforeError:_(t,e,"beforeError")}),l=(...t)=>{let e={},n={},r={};for(const o of t)if(Array.isArray(o))Array.isArray(e)||(e=[]),e=[...e,...o];else if(i(o)){for(let[t,n]of Object.entries(o))i(n)&&t in e&&(n=l(e[t],n)),e={...e,[t]:n};i(o.hooks)&&(r=c(r,o.hooks),e.hooks=r),i(o.headers)&&(n=a(n,o.headers),e.headers=n)}return e},d=(()=>{let t=!1,e=!1;const n="function"==typeof globalThis.ReadableStream,r="function"==typeof globalThis.Request;if(n&&r)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(t){if(t instanceof Error&&"unsupported BodyInit type"===t.message)return!1;throw t}return t&&!e})(),u="function"==typeof globalThis.AbortController,f="function"==typeof globalThis.ReadableStream,h="function"==typeof globalThis.FormData,b=["get","post","put","patch","head","delete"],p={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},g=2147483647,w=Symbol("stop"),m={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},y={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},v=t=>b.includes(t)?t.toUpperCase():t,x={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3},E=(t={})=>{if("number"==typeof t)return{...x,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...x,...t}};class T{static create(t,e){const n=new T(t,e),o=async()=>{if("number"==typeof n._options.timeout&&n._options.timeout>g)throw new RangeError("The `timeout` option cannot be greater than 2147483647");await Promise.resolve();let t=await n._fetch();for(const e of n._options.hooks.afterResponse){const r=await e(n.request,n._options,n._decorateResponse(t.clone()));r instanceof globalThis.Response&&(t=r)}if(n._decorateResponse(t),!t.ok&&n._options.throwHttpErrors){let e=new r(t,n.request,n._options);for(const t of n._options.hooks.beforeError)e=await t(e);throw e}if(n._options.onDownloadProgress){if("function"!=typeof n._options.onDownloadProgress)throw new TypeError("The `onDownloadProgress` option must be a function");if(!f)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return n._stream(t.clone(),n._options.onDownloadProgress)}return t},i=n._options.retry.methods.includes(n.request.method.toLowerCase())?n._retry(o):o();for(const[t,r]of Object.entries(p))i[t]=async()=>{n.request.headers.set("accept",n.request.headers.get("accept")||r);const o=(await i).clone();if("json"===t){if(204===o.status)return"";if(0===(await o.clone().arrayBuffer()).byteLength)return"";if(e.parseJson)return e.parseJson(await o.text())}return o[t]()};return i}request;abortController;_retryCount=0;_input;_options;constructor(t,e={}){if(this._input=t,this._options={...e,headers:a(this._input.headers,e.headers),hooks:c({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},e.hooks),method:v(e.method??this._input.method),prefixUrl:String(e.prefixUrl||""),retry:E(e.retry),throwHttpErrors:!1!==e.throwHttpErrors,timeout:e.timeout??1e4,fetch:e.fetch??globalThis.fetch.bind(globalThis)},"string"!=typeof this._input&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&"string"==typeof this._input){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(u){this.abortController=new globalThis.AbortController;const t=this._options.signal??this._input.signal;t?.addEventListener("abort",(()=>{this.abortController.abort(t.reason)})),this._options.signal=this.abortController.signal}if(d&&(this._options.duplex="half"),void 0!==this._options.json&&(this._options.body=this._options.stringifyJson?.(this._options.json)??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const t="?"+("string"==typeof this._options.searchParams?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),e=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,t);!(h&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)||this._options.headers&&this._options.headers["content-type"]||this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(e,{...this.request}),this._options)}}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount>this._options.retry.limit||t instanceof o)throw t;if(t instanceof r){if(!this._options.retry.statusCodes.includes(t.response.status))throw t;const e=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(e&&this._options.retry.afterStatusCodes.includes(t.response.status)){let t=1e3*Number(e);Number.isNaN(t)?t=Date.parse(e)-Date.now():t>=Date.parse("2024-01-01")&&(t-=Date.now());const n=this._options.retry.maxRetryAfter??t;return t<n?t:n}if(413===t.response.status)throw t}const e=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,e)}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(e){const n=Math.min(this._calculateRetryDelay(e),g);if(this._retryCount<1)throw e;await async function(t,{signal:e}){return new Promise(((n,r)=>{function o(){clearTimeout(i),r(e.reason)}e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));const i=setTimeout((()=>{e?.removeEventListener("abort",o),n()}),t)}))}(n,{signal:this._options.signal});for(const t of this._options.hooks.beforeRetry)if(await t({request:this.request,options:this._options,error:e,retryCount:this._retryCount})===w)return;return this._retry(t)}}async _fetch(){for(const t of this._options.hooks.beforeRequest){const e=await t(this.request,this._options);if(e instanceof Request){this.request=e;break}if(e instanceof Response)return e}const t=((t,e)=>{const n={};for(const r in e)r in y||r in m||r in t||(n[r]=e[r]);return n})(this.request,this._options),e=this.request;return this.request=e.clone(),!1===this._options.timeout?this._options.fetch(e,t):async function(t,e,n,r){return new Promise(((i,s)=>{const a=setTimeout((()=>{n&&n.abort(),s(new o(t))}),r.timeout);r.fetch(t,e).then(i).catch(s).then((()=>{clearTimeout(a)}))}))}(e,t,this.abortController,this._options)}_stream(t,e){const n=Number(t.headers.get("content-length"))||0;let r=0;return 204===t.status?(e&&e({percent:1,totalBytes:n,transferredBytes:r},new Uint8Array),new globalThis.Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(o){const i=t.body.getReader();e&&e({percent:0,transferredBytes:0,totalBytes:n},new Uint8Array),await async function t(){const{done:s,value:a}=await i.read();s?o.close():(e&&(r+=a.byteLength,e({percent:0===n?0:r/n,transferredBytes:r,totalBytes:n},a)),o.enqueue(a),await t())}()}}),{status:t.status,statusText:t.statusText,headers:t.headers})}}const P=t=>{const e=(e,n)=>T.create(e,s(t,n));for(const n of b)e[n]=(e,r)=>T.create(e,s(t,r,{method:n}));return e.create=t=>P(s(t)),e.extend=e=>("function"==typeof e&&(e=e(t??{})),P(s(t,e))),e.stop=w,e},S=P()},524:(t,e,n)=>{"use strict";var r=n(320);t.exports=n.v(e,t.id,"e5d769d093be3acfa1ed",{"./afrim_js_bg.js":{__wbindgen_error_new:r.Rj,__wbindgen_object_drop_ref:r.bk,__wbindgen_string_new:r.yc,__wbindgen_string_get:r.qN,__wbindgen_as_number:r.qm,__wbindgen_object_clone_ref:r.BZ,__wbindgen_is_object:r.qv,__wbg_crypto_d05b68a3572bb8ca:r.$D,__wbg_process_b02b3570280d0366:r.Mx,__wbg_versions_c1cb42213cedf0f5:r.Ke,__wbg_node_43b1089f407e4ec2:r.MF,__wbindgen_is_string:r.Gu,__wbg_require_9a7e0f667ead4995:r.O6,__wbg_msCrypto_10fc94afee92bd76:r.Si,__wbg_randomFillSync_b70ccbdf4926a99d:r.zQ,__wbg_getRandomValues_7e42b4fb8779dc6d:r.Uv,__wbg_now_4e659b3d15f470d9:r.xZ,__wbindgen_jsval_loose_eq:r.U8,__wbindgen_boolean_get:r.Nh,__wbindgen_number_get:r.sW,__wbg_String_b9412f8799faab3e:r.Zu,__wbindgen_number_new:r.QR,__wbindgen_bigint_from_i64:r.ce,__wbg_set_f975102236d3c502:r.DK,__wbindgen_is_function:r.PR,__wbg_self_ce0dbfc45cf2f5be:r.cX,__wbg_window_c6fb939a7f436783:r.kh,__wbg_globalThis_d1e6af4856ba331b:r.Kc,__wbg_global_207b558942527489:r.vA,__wbindgen_is_undefined:r.vU,__wbg_newnoargs_e258087cd0daa0ea:r.Pf,__wbg_length_cd7af8117672b8b8:r.O$,__wbg_new_16b304a2cfa7ff4a:r.M2,__wbg_new_d9bc3a0147634640:r.ae,__wbg_next_40fc327bfc8770e6:r.Xo,__wbg_value_d93c65011f51a456:r.qT,__wbg_iterator_2cee6dadfd956dfa:r.GR,__wbg_new_72fb9a18b5ae2624:r.ot,__wbg_get_bd8e338fbd5f5cc8:r.g_,__wbg_set_d4638f722068f043:r.QU,__wbg_isArray_2ab64d95e09ea0ae:r.f3,__wbg_instanceof_ArrayBuffer_836825be07d4c9d2:r.B7,__wbg_call_27c0f87801dedf93:r.cq,__wbg_call_b3ca7c6051f9bec1:r._m,__wbg_set_8417257aaedc936b:r.jg,__wbg_next_196c84450b364254:r.iS,__wbg_done_298b57d23c0fc80c:r.uL,__wbg_entries_95cc2c823b285a09:r.OZ,__wbg_get_e3c254076557e348:r.XB,__wbg_buffer_12d079cc21e14bdb:r.Fm,__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb:r.Lo,__wbg_new_63b92bc8671ed464:r.$Z,__wbg_instanceof_Uint8Array_2b3bbecd033d19f6:r.QD,__wbg_newwithlength_e9b4878cebadb3d3:r.v6,__wbg_subarray_a1f73cd4b5b42fe1:r.if,__wbg_length_c20a40f15020d68a:r.qY,__wbg_set_a47bac70306a19a7:r.Wv,__wbindgen_debug_string:r.rl,__wbindgen_throw:r.Qn,__wbindgen_memory:r.Py}})}},i={};function s(t){var e=i[t];if(void 0!==e)return e.exports;var n=i[t]={id:t,loaded:!1,exports:{}};return o[t].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}return t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},s.a=(o,i,s)=>{var a;s&&((a=[]).d=-1);var _,c,l,d=new Set,u=o.exports,f=new Promise(((t,e)=>{l=e,c=t}));f[e]=u,f[t]=t=>(a&&t(a),d.forEach(t),f.catch((t=>{}))),o.exports=f,i((o=>{var i;_=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[t])return o;if(o.then){var i=[];i.d=0,o.then((t=>{s[e]=t,r(i)}),(t=>{s[n]=t,r(i)}));var s={};return s[t]=t=>t(i),s}}var a={};return a[t]=t=>{},a[e]=o,a})))(o);var s=()=>_.map((t=>{if(t[n])throw t[n];return t[e]})),c=new Promise((e=>{(i=()=>e(s)).r=0;var n=t=>t!==a&&!d.has(t)&&(d.add(t),t&&!t.d&&(i.r++,t.push(i)));_.map((e=>e[t](n)))}));return i.r?c:s()}),(t=>(t?l(f[n]=t):c(u),r(a)))),a&&a.d<0&&(a.d=0)},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.v=(t,e,n,r)=>{var o=fetch(s.p+""+n+".module.wasm"),i=()=>o.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,r))).then((e=>Object.assign(t,e.instance.exports)));return o.then((e=>"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,r).then((e=>Object.assign(t,e.instance.exports)),(t=>{if("application/wasm"!==e.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t),i();throw t})):i()))},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),s(401)})()));